#ifndef WIFI_PENTEST_H
#define WIFI_PENTEST_H

#include <Arduino.h>
#include <WiFi.h>
#include <DNSServer.h>
#include <WebServer.h>
#include <vector>

// Structure to hold AP info
struct APInfo {
    String ssid;
    uint8_t bssid[6];
    int32_t rssi;
    uint8_t channel;
    bool encrypted;
};

class WiFiPentest {
private:
    std::vector<APInfo> scanResults;
    bool isScanning;
    DNSServer dnsServer;
    WebServer* webServer;
    bool serverRunning;
    
    // Attack state
    bool deauthRunning;
    bool portalRunning;
    bool karmaRunning;
    String targetSSID;
    uint8_t targetBSSID[6];
    uint8_t targetChannel;
    
    // Packet sniffing/injection callbacks
    static void snifferCallback(void* buf, wifi_promiscuous_pkt_type_t type);
    
public:
    WiFiPentest();
    ~WiFiPentest();
    
    // Scanning
    void scanNetworks();
    std::vector<APInfo> getResults();
    
    // Attacks
    void startDeauth(uint8_t* bssid, uint8_t channel);
    void stopDeauth();
    void updateDeauth(); // Call in loop
    
    void startEvilPortal(String ssid, String htmlContent = "");
    void stopEvilPortal();
    void handlePortal(); // Call in loop
    void saveCredential(String creds);
    
    void startKarma();
    void stopKarma();
    
    bool isDeauthActive() { return deauthRunning; }
    bool isPortalActive() { return portalRunning; }
    bool isKarmaActive() { return karmaRunning; }
};

#endif
